cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; pm2 logs

cd ~/proost/web/; rm -rf .build; node prepare.js; pm2 flush; pm2 delete web; pm2 flush; clear; yarn build; NODE_ENV=production pm2 start ./server/index.js --name web; pm2 logs


cd ~/proost/web/; rm -rf .build; node prepare.js; pm2 flush; clear; yarn build; NODE_ENV=production pm2 start ./server/index.js --name web; pm2 logs


next-apollo 2.1.3


WEB
cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; cd ~/proost/web/; rm -rf .build; node prepare.js; pm2 flush; clear; yarn build; NODE_ENV=production pm2 start ./server/index.js --name web; pm2 logs

WEB-OLD
cd ~/proost/dev-old/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; cd ~/proost/web-old/; rm -rf .build; node prepare.js; pm2 flush; clear; yarn build; NODE_ENV=production pm2 start ./server/index.js --name web; pm2 logs

WEB-DEV
cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; cd ~/proost/web/; rm -rf .build; node prepare.js; pm2 flush; clear; yarn build; NODE_ENV=development pm2 start ./server/index.js --name web; pm2 logs

ONLY DEV
cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api

ONLY DEV (in dev mode)
cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=development pm2 start server.js --name api

UPDATE/UPGRADE PACKAGES
sudo apt update; sudo apt upgrade -y; sudo apt update; sudo apt upgrade -y


cd ~/proost/dev-beta-wip/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; cd ~/proost/web-beta/; rm -rf .build; node prepare.js; pm2 flush; clear; yarn build; NODE_ENV=production pm2 start ./server/index.js --name web; pm2 logs


cd ~/proost/dev-beta/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=production pm2 start server.js --name api; cd ~/proost/Apollo-NextJS/;yarn next build;yarn next start






RUN DEV
cd ~/proost/dev/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=development pm2 start server.js --name api

RUN DEV-BETA
cd ~/proost/dev-beta/; pm2 flush; pm2 kill; pm2 flush; clear; NODE_ENV=development pm2 start server.js --name api

RUN DEV-BETA-DEVELOPMENT
cd ~/proost/dev/; pm2 kill; npm run develop



File counts:
------------
components: 56
components/blog: 13
components/svg-icons: 6
components/svg-icons/flags: 57



TO DO:
---------
authors list
author posts
tags list
tag posts
categories list
category posts



FORGOT PASSWORD
1. ask for email
2. check if email exists in db
3. if not, throw error: email doesn't exist
4. if yes, send email with link to set new password
5. show dialog saying email has been sent

REMEMBER ME
during first login:
1. create hash
2. store hash as cookie
3. store hash in db (user document)
during logout:
1. check if hash cookie exists
2. if yes, delete all cookies except hash cookie
3. if no, delete all cookies
during subsequent logins
1. check if hash cookie exists
2. if yes, split into username and hash
3. lookup db for matching username and hash
4. if matched, create userinfo cookie (and a new remember cookie) and proceed
5. if not matched or if hash cookie doesn't exist, present login dialog


CONNECT TO REDIS
telnet proost-sessions.fizfjx.0001.use2.cache.amazonaws.com 6379

REDIS COMMANDS
keys *
flushall
ctrl-] (exit redis)
ctrl-z (exit telnet)



REFRESH/FIRST LOAD
get session id from browser
look up session id on redis
if id present in redis, stay logged in
if not present, log out*

to log out, delete all cookies.




sudo apt install gcc
sudo apt install make
sudo apt install build-essential
yarn add hiredis redis






cookie tampered
google logged out









REGISTER:
------------

Input email
Generate token

check if email exists in db
    no:
          create entry with email and token
          send verification email
    yes:
          retrieve entry
          does entry have a token?
                yes: update token, send verification email
                no: does entry have password?
                      yes: throw error - account already exists
                      no: add token to entry and send verification email



VERIFICATION:
-----------------

retrieve email and token from link
check if email exists in db
    no: throw error - this link has expired
    yes: check if entry contains token
          no: throw error - this link has expired
          yes: do tokens match?
                no: throw error - this link has expired
                yes: check if entry contains firstname, lastname, username
                        offer to add missing data (firstname, lastname, username)
                        offer to add password
                        offer to confirm password
                        validate fields on client
                        validate fields on server
                        encrypt password using argon, delete token and update db
                        show success page
